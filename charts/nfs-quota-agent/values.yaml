# Default values for nfs-quota-agent

replicaCount: 1

image:
  repository: ghcr.io/dasomel/nfs-quota-agent
  pullPolicy: IfNotPresent
  tag: ""  # Defaults to chart appVersion

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

# NFS quota agent configuration
config:
  # Local path where NFS export is mounted in container
  nfsBasePath: /export
  # NFS server's export path
  nfsServerPath: /data
  # Provisioner name to filter PVs
  # Options:
  #   - nfs.csi.k8s.io (csi-driver-nfs, recommended)
  #   - cluster.local/nfs-subdir-external-provisioner (legacy)
  provisionerName: nfs.csi.k8s.io
  # Process all NFS PVs regardless of provisioner
  processAllNFS: false
  # Interval between quota syncs
  syncInterval: 30s
  # Metrics server address (set to empty string to disable)
  metricsAddr: ":9090"

# Web UI configuration
webUI:
  enabled: false
  addr: ":8080"

# Audit logging configuration
audit:
  enabled: false
  # Path to audit log file inside container
  logPath: /var/log/nfs-quota-agent/audit.log
  # Host path for persistent audit logs (mounted as hostPath volume)
  hostPath: /var/log/nfs-quota-agent

# Auto-cleanup configuration for orphaned directories
cleanup:
  enabled: false
  # Interval between cleanup runs (e.g., 1h, 30m)
  interval: 1h
  # Grace period before deleting orphaned directories
  gracePeriod: 24h
  # Dry-run mode: log what would be deleted but don't actually delete
  dryRun: true

# Usage history and trend tracking
history:
  enabled: false
  # Path to store history data inside container
  path: /var/lib/nfs-quota-agent/history.json
  # Interval between history snapshots
  interval: 5m
  # How long to keep history data
  retention: 720h  # 30 days
  # Host path for persistent history (mounted as hostPath volume)
  hostPath: /var/lib/nfs-quota-agent

# Namespace quota policy
policy:
  enabled: false
  # Global default quota for namespaces without annotation
  defaultQuota: 1Gi
  # Enforce maximum quota from namespace annotation
  enforceMaxQuota: false

# Metrics service configuration
service:
  enabled: true
  type: ClusterIP
  port: 9090
  # Web UI port (only used when webUI.enabled is true)
  uiPort: 8080
  annotations: {}
  # prometheus.io/scrape: "true"
  # prometheus.io/port: "9090"

# NFS export volume configuration
nfsExport:
  # Host path to NFS export directory on the server
  hostPath: /data

serviceAccount:
  create: true
  annotations: {}
  name: ""

# Node selector to run on NFS server node
# Label your NFS server node: kubectl label node <node> nfs-server=true
nodeSelector:
  nfs-server: "true"

tolerations:
  - key: "node-role.kubernetes.io/control-plane"
    operator: "Exists"
    effect: "NoSchedule"

affinity: {}

resources:
  limits:
    cpu: 100m
    memory: 128Mi
  requests:
    cpu: 50m
    memory: 64Mi

# Security context for the container
# Privileged is required for xfs_quota/setquota commands
securityContext:
  privileged: true

podSecurityContext: {}

podAnnotations: {}

podLabels: {}
